import{getCart,cartReady,callShopifyAPI,addCartLine,applyDiscountCode}from"./cart-core.js";import{REMOVE_FROM_CART_MUTATION,UPDATE_CART_LINE_MUTATION}from"./shopifyApi.js";const cartDrawer=document.getElementById("cart-drawer"),cartOverlay=document.getElementById("cart-overlay"),closeCartBtn=document.getElementById("close-cart-btn"),cartItemsContainer=cartDrawer.querySelector(".cart-items-container"),emptyCartMessage=document.getElementById("empty-cart-message"),cartSubtotalElement=document.getElementById("cart-subtotal"),checkoutBtn=document.getElementById("checkout-btn"),cartLoadingOverlay=document.getElementById("cart-loading-overlay"),cartErrorContainer=document.getElementById("cart-error"),cartErrorMessage=document.getElementById("cart-error-message"),aliaDiscountSection=document.getElementById("alia-discount-section"),aliaRewardTextElement=document.getElementById("alia-reward-text"),aliaDiscountCodeElement=document.getElementById("alia-discount-code"),aliaTimerElement=document.getElementById("alia-timer"),aliaExpiredMessageElement=document.getElementById("alia-expired-message");let cart=null,aliaTimerInterval=null,isLoading=!1,previousActiveElement=null;const UVLIZER_PREFIX="uvlizer_",ALIA_CODE_STORAGE_KEY="uvlizer_alia_discount_code",ALIA_TEXT_STORAGE_KEY="uvlizer_alia_reward_text",ALIA_EXPIRY_STORAGE_KEY="uvlizer_alia_expiry_timestamp";function setLoading(t){isLoading=t,cartLoadingOverlay&&cartLoadingOverlay.classList.toggle("hidden",!t),document.body.style.cursor=t?"wait":"default",checkoutBtn&&(checkoutBtn.disabled=t||cart&&0===cart.totalQuantity,checkoutBtn.classList.toggle("opacity-50",t||cart&&0===cart.totalQuantity)),cartItemsContainer?.querySelectorAll(".remove-item-btn, .quantity-btn").forEach((e=>e.disabled=t))}function showCartError(t,e=5e3){window.cartErrorTimeout&&clearTimeout(window.cartErrorTimeout),cartErrorMessage&&cartErrorContainer?(cartErrorMessage.textContent=t,cartErrorContainer.classList.remove("hidden"),setTimeout((()=>{cartErrorContainer.classList.add("visible"),"undefined"!=typeof lucide&&lucide.createIcons({nodes:cartErrorContainer.querySelectorAll("[data-lucide]")})}),10),e>0&&(window.cartErrorTimeout=setTimeout(hideCartError,e))):alert(t)}function hideCartError(){cartErrorContainer&&(cartErrorContainer.classList.remove("visible"),setTimeout((()=>cartErrorContainer.classList.add("hidden")),300))}function createElevarProductObj(t,e=!0){let a=t.merchandise?.price?.amount,r=t.merchandise?.compareAtPrice?.amount,n=19900,o=24900;try{if("number"==typeof a)n=Number.isInteger(a)?a:Math.round(100*a);else if("string"==typeof a){const t=parseFloat(a);isNaN(t)||(n=a.includes(".")?Math.round(100*t):parseInt(a,10))}}catch(t){}try{if("number"==typeof r)o=Number.isInteger(r)?r:Math.round(100*r);else if("string"==typeof r){const t=parseFloat(r);o=isNaN(t)?n:r.includes(".")?Math.round(100*t):parseInt(r,10)}else o=n}catch(t){o=n}const i={id:t.merchandise?.product?.handle||"",name:t.merchandise?.product?.title||"",brand:"Uvlizer",category:"Home & Garden",variant:t.merchandise?.title||"",price:(n/100).toFixed(2),product_id:t.merchandise?.product?.id?.substring(t.merchandise.product.id.lastIndexOf("/")+1)||"",variant_id:t.merchandise?.id?.substring(t.merchandise.id.lastIndexOf("/")+1)||"",compare_at_price:(o/100).toFixed(2),image:t.merchandise?.image?.url||"",list:location.pathname};return e&&void 0!==t.quantity?i.quantity=t.quantity.toString():e&&(i.quantity="1"),i}function createElevarImpressionObj(t,e){let a=t.merchandise?.price?.amount,r=t.merchandise?.compareAtPrice?.amount,n=19900,o=24900;try{if("number"==typeof a)n=Number.isInteger(a)?a:Math.round(100*a);else if("string"==typeof a){const t=parseFloat(a);isNaN(t)||(n=a.includes(".")?Math.round(100*t):parseInt(a,10))}}catch(t){}try{if("number"==typeof r)o=Number.isInteger(r)?r:Math.round(100*r);else if("string"==typeof r){const t=parseFloat(r);o=isNaN(t)?n:r.includes(".")?Math.round(100*t):parseInt(r,10)}else o=n}catch(t){o=n}return{id:t.merchandise?.product?.handle||"",name:t.merchandise?.product?.title||"",brand:"Uvlizer",category:"Home & Garden",variant:t.merchandise?.title||"",price:(n/100).toFixed(2),quantity:t.quantity?t.quantity.toString():"1",product_id:t.merchandise?.product?.id?.substring(t.merchandise.product.id.lastIndexOf("/")+1)||"",variant_id:t.merchandise?.id?.substring(t.merchandise.id.lastIndexOf("/")+1)||"",compare_at_price:(o/100).toFixed(2),image:t.merchandise?.image?.url||"",position:e+1}}async function removeCartLineDrawer(t,e){let a=null;if(cart&&window.ElevarDataLayer){const t=cart.lines.nodes.find((t=>t.id===e));t&&(a=createElevarProductObj(t,!0),a.quantity=t.quantity.toString(),a.list=location.pathname)}try{const r=await callShopifyAPI(REMOVE_FROM_CART_MUTATION,{cartId:t,lineIds:[e]}),n=r?.cartLinesRemove?.cart;if(a&&n){const t={event:"dl_remove_from_cart",user_properties:{visitor_type:"guest"},ecommerce:{currencyCode:n.cost?.totalAmount?.currencyCode||"USD",remove:{actionField:{list:location.pathname},products:[a]}}};window.ElevarDataLayer.push(t)}return n&&(cart=n),n}catch(t){throw console.error(`[Cart Drawer] Error removing line ${e}:`,t),t}}async function updateCartLineDrawer(t,e){try{const a=await callShopifyAPI(UPDATE_CART_LINE_MUTATION,{cartId:cart.id,lines:[{id:t,quantity:e}]}),r=a?.cartLinesUpdate?.cart;return r&&(cart=r),r}catch(a){throw console.error(`[Cart Drawer] Error updating line ${t} to quantity ${e}:`,a),a}}function renderCartItems(){const t=document.getElementById("cart-item-template");if(!(cart&&cart.lines?.nodes.length&&t&&cartItemsContainer)){if(emptyCartMessage){emptyCartMessage.classList.remove("hidden"),emptyCartMessage.innerHTML='Your cart is empty.<br><br><a href="#" id="continue-shopping-empty" class="inline-block bg-red-600 text-white text-base font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-red-700 transition duration-300 text-center">Continue Shopping</a>';const t=document.getElementById("continue-shopping-empty");t&&!t.getAttribute("data-listener-added")&&(t.addEventListener("click",(t=>{t.preventDefault(),closeDrawer()})),t.setAttribute("data-listener-added","true"))}return void(cartItemsContainer&&(cartItemsContainer.innerHTML=""))}emptyCartMessage&&emptyCartMessage.classList.add("hidden");const e=new Set(cart.lines.nodes.map((t=>t.id)));cartItemsContainer.querySelectorAll(".cart-item[data-line-id]").forEach((t=>{e.has(t.getAttribute("data-line-id"))||t.remove()})),cart.lines.nodes.forEach((e=>{let a=cartItemsContainer.querySelector(`.cart-item[data-line-id="${e.id}"]`);if(a)updateCartItemContent(a,e,!1);else{const r=t.content?.firstElementChild;if(a=r?r.cloneNode(!0):t.cloneNode(!0),a.classList.remove("hidden"),a.removeAttribute("id"),a.setAttribute("data-line-id",e.id),updateCartItemContent(a,e,!0),cartItemsContainer.appendChild(a),window.lucide?.createIcons)try{window.lucide.createIcons({nodes:[a]})}catch(t){}}}))}function updateCartItemContent(t,e,a=!1){const r=e.merchandise;if(a){const e=t.querySelector("[data-cart-item-image]");e&&(e.src=r.image?.url||"",e.alt=r.image?.altText||r.product.title);const a=t.querySelector("[data-cart-item-name]");a&&(a.textContent=r.product.title)}const n=t.querySelector("[data-cart-item-quantity]");n&&(n.textContent=e.quantity);const o=t.querySelector("[data-cart-item-price]");o&&(o.textContent=`$${parseFloat(e.cost.totalAmount.amount).toFixed(2)}`);const i=t.querySelector("[data-cart-item-original-price]");if(i){const t=r.compareAtPrice?parseFloat(r.compareAtPrice.amount):null,a=parseFloat(r.price.amount);if(t&&t>a){const a=t*e.quantity;i.textContent=`$${a.toFixed(2)}`,i.classList.remove("hidden")}else i.classList.add("hidden")}const c=t.querySelector(".quantity-minus-btn");c&&(c.disabled=e.quantity<=0)}function updateCartIconCount(){const t=document.getElementById("cart-item-count"),e=document.getElementById("open-cart-trigger"),a=cart?.totalQuantity||0;t&&(t.textContent=a),e&&(e.classList.remove("hidden"),t?.classList.toggle("hidden",0===a))}function renderCartSummary(){const t=document.getElementById("installment-info"),e=document.getElementById("cart-original-total"),a=document.getElementById("total-savings-amount"),r=document.getElementById("cart-subtotal");if(!cart||!cart.lines?.nodes.length)return e&&(e.textContent="$0.00"),a&&(a.textContent="-$0.00"),r&&(r.textContent="$0.00"),checkoutBtn&&(checkoutBtn.setAttribute("data-checkout-url","#"),checkoutBtn.disabled=!0,checkoutBtn.classList.add("opacity-50")),void(t&&(t.innerHTML=""));let n=0,o=0;cart.lines.nodes.forEach((t=>{const e=t.merchandise,a=t.quantity,r=e.compareAtPrice?parseFloat(e.compareAtPrice.amount):null,i=parseFloat(e.price.amount);n+=(r&&r>i?r:i)*a,o+=i*a}));const i=o,c=n-i;if(e&&(e.textContent=`$${n.toFixed(2)}`),a&&(a.textContent=`-$${c.toFixed(2)}`),r&&(r.textContent=`$${i.toFixed(2)}`),checkoutBtn&&(checkoutBtn.disabled=0===i,checkoutBtn.classList.toggle("opacity-50",0===i),checkoutBtn.setAttribute("data-checkout-url",cart.checkoutUrl||"#")),t)if(i>0){const e=(i/4).toFixed(2),a=t.querySelector("b");if(a)a.textContent!==`$${e}`&&(a.textContent=`$${e}`);else{const a="https://res.cloudinary.com/dg8ibuag5/image/upload/v1743723089/Shop_Pay_logo_purple_xqxhd1.svg";t.innerHTML=`or 4 interest-free payments of <b>$${e}</b> with <img src="${a}" alt="Shop Pay" class="inline-block h-4 ml-1 align-middle" loading="lazy">`}}else t.innerHTML=""}function renderAppliedDiscounts(){let t=null,e=0,a="";try{t=localStorage.getItem(ALIA_CODE_STORAGE_KEY);const r=localStorage.getItem(ALIA_EXPIRY_STORAGE_KEY);e=r?parseInt(r):0,a=localStorage.getItem(ALIA_TEXT_STORAGE_KEY)||""}catch(t){}const r=t&&e&&e>Date.now(),n=cart?.discountCodes?.some((e=>e.code===t));if(r&&n)aliaRewardTextElement&&(aliaRewardTextElement.textContent=a||"Discount Applied"),aliaDiscountCodeElement&&(aliaDiscountCodeElement.textContent=t),aliaDiscountSection&&aliaDiscountSection.classList.remove("hidden"),startAliaTimer(Math.floor((e-Date.now())/1e3));else if(aliaDiscountSection&&aliaDiscountSection.classList.add("hidden"),aliaExpiredMessageElement&&aliaExpiredMessageElement.classList.add("hidden"),clearInterval(aliaTimerInterval),t&&e&&e<=Date.now())try{localStorage.removeItem(ALIA_CODE_STORAGE_KEY),localStorage.removeItem(ALIA_TEXT_STORAGE_KEY),localStorage.removeItem(ALIA_EXPIRY_STORAGE_KEY)}catch(t){}}function startAliaTimer(t){if(clearInterval(aliaTimerInterval),!aliaTimerElement||!aliaDiscountSection)return;if(t<=0){aliaTimerElement.textContent="Expired",aliaDiscountSection.classList.add("opacity-50");try{localStorage.removeItem(ALIA_CODE_STORAGE_KEY),localStorage.removeItem(ALIA_TEXT_STORAGE_KEY),localStorage.removeItem(ALIA_EXPIRY_STORAGE_KEY)}catch(t){}return renderAppliedDiscounts(),void renderCartSummary()}aliaDiscountSection.classList.remove("opacity-50");let e=t;const a=()=>{const t=Math.floor(e/60),a=e%60;aliaTimerElement.textContent=`${t}:${a<10?"0":""}${a}`};a(),aliaTimerInterval=setInterval((()=>{if(e--,a(),e<0){clearInterval(aliaTimerInterval),aliaTimerElement.textContent="Expired",aliaDiscountSection.classList.add("opacity-50");try{localStorage.removeItem(ALIA_CODE_STORAGE_KEY),localStorage.removeItem(ALIA_TEXT_STORAGE_KEY),localStorage.removeItem(ALIA_EXPIRY_STORAGE_KEY)}catch(t){}cart?.id?applyDiscountCode(cart.id).then((t=>{t&&(cart=t,renderCart(),aliaExpiredMessageElement&&aliaExpiredMessageElement.classList.remove("hidden"))})).catch((t=>{console.error("Error removing discount code from Shopify cart:",t),renderCart(),aliaExpiredMessageElement&&aliaExpiredMessageElement.classList.remove("hidden")})):(renderCart(),aliaExpiredMessageElement&&aliaExpiredMessageElement.classList.remove("hidden"))}}),1e3)}function renderCart(){cart&&(renderCartItems(),renderCartSummary(),renderAppliedDiscounts(),updateCartIconCount(),setLoading(!1))}function openDrawer(){if(cartDrawer&&cartOverlay&&(previousActiveElement=document.activeElement,cartOverlay.classList.remove("hidden","pointer-events-none"),cartOverlay.classList.add("pointer-events-auto"),setTimeout((()=>cartOverlay.classList.add("opacity-100")),10),cartDrawer.classList.remove("translate-x-full"),cartDrawer.classList.add("translate-x-0"),cartDrawer.setAttribute("aria-hidden","false"),document.documentElement.classList.add("cart-drawer-open"),setTimeout((()=>{const t=cartDrawer.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&t[0].focus(),cartDrawer.addEventListener("keydown",handleFocusTrap)}),10),cart&&(renderCart(),window.ElevarDataLayer&&cart.lines?.nodes.length>0))){const t=cart.lines.nodes.map(((t,e)=>createElevarImpressionObj(t,e)));let e=cart?.cost?.subtotalAmount?.amount,a=0;try{if("number"==typeof e)a=Number.isInteger(e)?e:Math.round(100*e);else if("string"==typeof e){const t=parseFloat(e);isNaN(t)||(a=e.includes(".")?Math.round(100*t):parseInt(e,10))}}catch(t){}const r={event:"dl_view_cart",user_properties:{visitor_type:"guest"},cart_total:(a/100).toFixed(2),ecommerce:{currencyCode:cart.cost?.totalAmount?.currencyCode||"USD",actionField:{list:"Shopping Cart"},impressions:t}};window.ElevarDataLayer.push(r)}}function closeDrawer(){cartDrawer&&cartOverlay&&(cartOverlay.classList.remove("opacity-100","pointer-events-auto"),cartOverlay.classList.add("pointer-events-none"),setTimeout((()=>cartOverlay.classList.add("hidden")),300),cartDrawer.classList.remove("translate-x-0"),cartDrawer.classList.add("translate-x-full"),document.documentElement.classList.remove("cart-drawer-open"),cartDrawer.setAttribute("aria-hidden","true"),cartDrawer.removeEventListener("keydown",handleFocusTrap),previousActiveElement&&(previousActiveElement.focus(),previousActiveElement=null),hideCartError())}async function handleRemoveItem(t){const e=t instanceof Event?t.currentTarget:t;let a=e.getAttribute("data-line-id");if(!a){const t=e.closest(".cart-item");a=t?.getAttribute("data-line-id")}if(cart&&a)try{await removeCartLineDrawer(cart.id,a)&&renderCart()}catch(t){showCartError("Could not remove item. Please try again.")}}async function handleUpdateItemQuantity(t,e){if(cart&&t&&!(e<0))try{let a;a=0===e?await removeCartLineDrawer(cart.id,t):await updateCartLineDrawer(t,e),a&&renderCart()}catch(t){showCartError("Could not update item quantity. Please try again.")}}async function handleAddItemClick(t){if(t&&cart?.id)try{const e=await addCartLine(cart.id,t,1);if(e){cart=e;const a=e.lines.nodes.find((e=>e.merchandise.id===t));if(a){const t=e.lines.nodes.map((t=>{const e=t.merchandise;return{ProductID:e.id,SKU:e.sku||"",ProductName:e.product.title,Quantity:t.quantity,ItemPrice:parseFloat(e.price.amount),RowTotal:parseFloat(t.cost.totalAmount.amount),ImageURL:e.image?.url,ProductURL:window.location.origin+e.product.url,ProductCategories:e.product.collections?.nodes?.map((t=>t.title))||[],Brand:"UvLizer",VariantName:e.title}})),r=[...new Set(t.flatMap((t=>t.ProductCategories)))],n=t.map((t=>t.ProductName)),o={total_price:parseFloat(e.cost.totalAmount.amount),$value:parseFloat(e.cost.totalAmount.amount),original_total_price:parseFloat(e.cost.subtotalAmount.amount),ItemNames:n,Categories:r,ItemCount:e.totalQuantity,CheckoutURL:e.checkoutUrl||"",items:t};"undefined"!=typeof klaviyo?klaviyo.push(["track","Added to Cart",o]):console.warn('Klaviyo object not found. "Added to Cart" event not tracked.');const i=JSON.parse(JSON.stringify(cart)),c=createElevarProductObj(a,!0),s=i?.lines?.nodes.find((t=>t.merchandise.id===a.merchandise.id)),d=s?a.quantity-s.quantity:a.quantity;c.quantity=d>0?d.toString():"1",c.list=location.pathname;const l={event:"dl_add_to_cart",user_properties:{visitor_type:"guest"},ecommerce:{currencyCode:e.cost?.totalAmount?.currencyCode||"USD",add:{actionField:{list:location.pathname},products:[c]}}};window.ElevarDataLayer.push(l)}renderCart(),openDrawer()}}catch(t){showCartError(t.message.includes("Inventory")||t.message.includes("stock")?`Could not add item: ${t.message}`:"Could not add item to cart. Please try again."),renderCart()}}function setupEventListeners(){const t=document.getElementById("open-cart-trigger");t&&t.addEventListener("click",openDrawer),closeCartBtn&&closeCartBtn.addEventListener("click",closeDrawer),cartOverlay&&cartOverlay.addEventListener("click",closeDrawer);const e=document.getElementById("continue-shopping-btn");e&&e.addEventListener("click",closeDrawer),checkoutBtn&&checkoutBtn.addEventListener("click",(()=>{const t=cart?.checkoutUrl;if(window.checkoutResetTimeout&&clearTimeout(window.checkoutResetTimeout),cart&&cart.totalQuantity>0&&t&&"#"!==t){checkoutBtn.disabled=!0,checkoutBtn.classList.add("opacity-50"),checkoutBtn.textContent="Redirecting...";try{const e=new URL(t),a=window.location.hostname;a.endsWith(".trylumiclean.com")?e.hostname="trylumiclean.com":a.endsWith(".uvlizer.us")&&(e.hostname="uvlizer.us");const r=e.toString(),n=(new URLSearchParams).toString();let o=r+(n?(r.includes("?")?"&":"?")+n:"");window.location.href=o,window.checkoutResetTimeout=setTimeout((()=>{checkoutBtn.disabled=!1,checkoutBtn.classList.remove("opacity-50"),checkoutBtn.textContent="Proceed to Checkout",window.checkoutResetTimeout=null}),5e3)}catch(t){console.error("Error constructing checkout URL:",t),showCartError("Could not determine checkout URL. Please try again."),checkoutBtn.disabled=!1,checkoutBtn.classList.remove("opacity-50"),checkoutBtn.textContent="Proceed to Checkout"}}else showCartError(0===cart?.totalQuantity?"Your cart is empty.":"Could not proceed to checkout.")})),document.querySelectorAll(".js-main-cta").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const a=t.getAttribute("data-variant-id");if(!a)return console.error("Button clicked does not have a data-variant-id attribute!"),void showCartError("Could not determine the product to add. Please try again.");handleAddItemClick(a)}))})),cartItemsContainer&&cartItemsContainer.addEventListener("click",(function(t){const e=t.target.closest(".quantity-minus-btn");if(e){const t=e.closest(".cart-item"),a=t?.getAttribute("data-line-id");return void optimisticLineQuantityChange(t,a,-1)}const a=t.target.closest(".quantity-plus-btn");if(a){const t=a.closest(".cart-item"),e=t?.getAttribute("data-line-id");return void optimisticLineQuantityChange(t,e,1)}const r=t.target.closest(".remove-item-btn");r&&handleRemoveItem(r)})),window.addEventListener("pagehide",(()=>{window.checkoutResetTimeout&&clearTimeout(window.checkoutResetTimeout)})),document.addEventListener("alia:rewardClaimed",(async t=>{if(isLoading)return;const{rewardText:e,discountCode:a}=t.detail;if(!a||!cart?.id)return;const r=Date.now()+18e5;try{const n=await applyDiscountCode(cart.id,a);if(!n)throw new Error("Failed to update cart with discount code.");{const o=n.discountCodes?.some((t=>t.code===a));if(!o)throw new Error("Discount code was not applied successfully by Shopify.");try{localStorage.setItem(ALIA_CODE_STORAGE_KEY,a),localStorage.setItem(ALIA_TEXT_STORAGE_KEY,e),localStorage.setItem(ALIA_EXPIRY_STORAGE_KEY,r.toString())}catch(t){}cart=n,renderCart(),openDrawer()}}catch(e){showCartError(`Could not apply discount: ${e.message}`);try{localStorage.removeItem(ALIA_CODE_STORAGE_KEY),localStorage.removeItem(ALIA_TEXT_STORAGE_KEY),localStorage.removeItem(ALIA_EXPIRY_STORAGE_KEY)}catch(t){}renderAppliedDiscounts()}}))}function toggleLineButtons(t,e){t&&t.querySelectorAll(".quantity-btn").forEach((t=>t.disabled=e))}async function optimisticLineQuantityChange(t,e,a){if(!t||!e)return;const r=t.querySelector("[data-cart-item-quantity]");if(!r)return;const n=parseInt(r.textContent)||0,o=n+a;if(o<0)return;if(toggleLineButtons(t,!0),0===o){t.style.opacity="0.5";try{await handleUpdateItemQuantity(e,0)}catch(e){t.style.opacity="1",toggleLineButtons(t,!1)}return}r.textContent=o;const i=t.querySelector(".quantity-minus-btn");i&&(i.disabled=o<=0);try{await handleUpdateItemQuantity(e,o)}catch(e){r.textContent=n,toggleLineButtons(t,!1),i&&(i.disabled=n<=0)}}function handleFocusTrap(t){if("Tab"!==t.key||!cartDrawer)return;const e=cartDrawer.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===e.length)return;const a=e[0],r=e[e.length-1];t.shiftKey?document.activeElement===a&&(r.focus(),t.preventDefault()):document.activeElement===r&&(a.focus(),t.preventDefault())}async function initializeDrawer(){cart=await getCart(),initializeLucideIcons(),setupEventListeners(),renderCart(),updateCartIconCount()}function initializeLucideIcons(){if("function"==typeof window.lucide?.createIcons)try{const t={attrs:{"stroke-width":"1.5",stroke:"currentColor"}};window.lucide.icons&&Object.keys(window.lucide.icons).length&&(t.icons=window.lucide.icons),window.lucide.createIcons(t)}catch(t){}}cartReady.then(initializeDrawer).catch((t=>{console.error("Drawer initialization failed because cart core failed:",t)}));